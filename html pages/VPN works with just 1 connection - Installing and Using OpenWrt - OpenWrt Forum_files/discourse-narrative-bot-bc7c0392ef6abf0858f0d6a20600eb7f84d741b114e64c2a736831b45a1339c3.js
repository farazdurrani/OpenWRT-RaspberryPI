define("discourse/plugins/discourse-narrative-bot/initializers/new-user-narrative",["exports","discourse/lib/ajax","discourse-common/lib/debounce","discourse/lib/is-element-in-viewport","discourse/lib/plugin-api"],(function(e,t,i,r,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s="new-user-narrative";function n(e){var o=e.container.lookup("message-bus:main"),n=e.getCurrentUser(),a=e.container.lookup("service:app-events");e.modifyClass("component:site-header",{pluginId:s,didInsertElement:function(){this._super.apply(this,arguments),this.dispatch("header:search-context-trigger","header")}}),e.modifyClass("controller:topic",{pluginId:s,_modifyBookmark:function(e,i){var r=this;return i&&-2===i.user_id&&!i.bookmarked?(0,t.ajax)("/bookmarks",{type:"POST",data:{post_id:i.id}}).then((function(e){i.setProperties({"topic.bookmarked":!0,bookmarked:!0,bookmark_id:e.id}),i.appEvents.trigger("post-stream:refresh",{id:r.id})})):this._super(e,i)},subscribe:function(){var e=this;this._super.apply(this,arguments),this.messageBus.subscribe("/topic/".concat(this.get("model.id")),(function(t){var i=e.model;if(i.get("isPrivateMessage")&&e.currentUser&&e.currentUser.get("id")!==t.user_id&&-2===t.user_id&&"created"===t.type){var r=t.post_number,o=i.get("highest_post_number")<=r,s=r-i.get("currentPost");o&&s>0&&s<7&&e._scrollToDiscobotPost(t.post_number)}}))},_scrollToDiscobotPost:function(e){(0,i.default)(this,(function(){var t=document.querySelector(".topic-post article#post_".concat(e));if(t&&!(0,r.default)(t)){var i=parseInt(getComputedStyle(document.body).getPropertyValue("--header-offset"),10)||0,o=t.getBoundingClientRect();window.scrollTo({top:window.scrollY+o.top-i,behavior:"smooth"})}}),e,500)}}),e.attachWidgetAction("header","headerSearchContextTrigger",(function(){this.site.mobileView?this.state.skipSearchContext=!1:(this.state.contextEnabled=!0,this.state.searchContextType="topic")})),o&&n&&o.subscribe("/new_user_narrative/tutorial_search",(function(){a.trigger("header:search-context-trigger")}))}var a={name:"new-user-narratve",initialize:function(e){e.lookup("site-settings:main").discourse_narrative_bot_enabled&&(0,o.withPluginApi)("0.8.7",n)}};e.default=a}));
//# sourceMappingURL=/assets/plugins/discourse-narrative-bot-bc7c0392ef6abf0858f0d6a20600eb7f84d741b114e64c2a736831b45a1339c3.js.map